:doctype: book
:imagesdir: images
:stylesheet: paper.css
:last-update-label!:
:source-highlighter: highlight.js
:highlightjs-theme: thesis
:highlightjsdir: libraries/highlightjs
:stem:
:toc: macro
:xrefstyle: short
ifndef::env-vscode[]
:kroki-fetch-diagram: true
:kroki-default-options: inline
endif::env-vscode[]

image::../assets/logo_hda.svg[role=logo]

[.university.text-center]
Darmstadt University of Applied Sciences

[.faculty.text-center]
Faculty of Computer Science

[discrete#main-title]
= Lab report for the first high-performance computing exercise

[.presented-by.text-center]
by +
****REMOVED**** ***REMOVED*** +
****REMOVED**** ***REMOVED***

:part-signifier: Part
:listing-caption: Listing

== Evaluation 

Figures, tables, and listings are automatically numbered and added to their respective list after the table of contents.

=== Setup

We tested for different parallel implementations for calculating pi. One uses cpp threads, one uses openmp, one c implementation using MPI and one CPP implementation useing MPI. We tested the implementations with a 1 2 4 and 8 threads on Lennarts computer (shown in <<our-computers>>). 

.Weird chart
:chart-id: id=weird-chart
:vega-lite-filename: processed-assets/compiler-comparison.vl.json
include::scripts/vega-chart.adoc[]

<<weird-chart>> shows our first measurements. You can see two different performance characteristics, one for the MPI implementations and one for the other implementations. On further investigation we discovered, that the MPI implementations actually used gcc, while the other implementations used clang. This is because the MPI compiler uses gcc by default if the `OMPI_CC`. We noticed that there is a significant performance difference between the executables created with GCC and clang. <<compiler-chart>> compares the performance of the different compilers.

Because of this, we decided to only use clang for our further measurements. The optimization level was set to `-O3` for all measurements. We measured the performance for 1, 2, 4 and 8 threads. If not specified otherwise the value for n is set to 8192.

.Example of openMP in CPP
[source#openmp-example,cpp]
----
include::KickOff/openMP-pi.cpp[tag=openmp]
----

=== Measurements

.This chart
:chart-id: id=this-chart
:vega-lite-filename: processed-assets/mpi-cpp.vl.json
include::scripts/vega-chart.adoc[]

.That chart
:chart-id: id=that-chart
:vega-lite-filename: processed-assets/implementation-comparison-fixed-n.vl.json
include::scripts/vega-chart.adoc[]

.Important chart
:chart-id: id=important-chart
:vega-lite-filename: processed-assets/implementation-comparison-fixed-threads.vl.json
include::scripts/vega-chart.adoc[]

=== Benchmarking the implementations on the virgo cluster

.Notes
- 128 threads is the highest number of cores for 1 node consistently on the main partition.
- 1 Job tests all four implementations once for each n.
- For each tested number of threads we ran 10 jobs.

.Performance of the different implementations with 1 thread
:chart-id: id=performance-low-threads
:vega-lite-filename: processed-assets/performance-low-threads.vl.json
include::scripts/vega-chart.adoc[]

.Performance of the different implementations with 8 threads
:chart-id: id=performance-medium-threads
:vega-lite-filename: processed-assets/performance-medium-threads.vl.json
include::scripts/vega-chart.adoc[]

.Performance of the different implementations with 128 threads
:chart-id: id=performance-high-threads
:vega-lite-filename: processed-assets/performance-high-threads.vl.json
include::scripts/vega-chart.adoc[]

We can see that both mpi implementations behave nearly identically. In the more detailed charts the mpi C implementation will be omitted.

.Performance of mpi-cpp
:chart-id: id=mpi-cpp-virgo
:vega-lite-filename: processed-assets/mpi-cpp-virgo.vl.json
include::scripts/vega-chart.adoc[]

.Performance of openmp
:chart-id: id=openmp-virgo
:vega-lite-filename: processed-assets/openmp-virgo.vl.json
include::scripts/vega-chart.adoc[]

.Performance of native C++ threads
:chart-id: id=cpp-threads-virgo
:vega-lite-filename: processed-assets/cpp-threads-virgo.vl.json
include::scripts/vega-chart.adoc[]



== Appendix

[#our-computers,cols="1,2,2"]
.Our computers
|===
|sdfs
|Lennart
|Bj√∂rn 

|CPU
|i9-11950H @ 2.6GHz
|i5-7200U @ 2.5GHz

|CPU-Kerne / Threads
|8 / 16
|2 / 4

|GPU
|RTX3070 mobile
|Intel HD Graphics 620

|OS
|Nix OS unstable/latest - 64 Bit
|Ubuntu 23.04 - 64 Bit

|RAM (GB)
|32
|8
|=== 

.C++ threads implementation
[source#cpp-threads-listing.linenums,cpp]
----
include::KickOff/cpp11-pi.cpp[]
----

.C++ openMP implementation
[source#openMP-listing.linenums,cpp]
----
include::KickOff/openMP-pi.cpp[]
----

.C++ MPI implementation
[source#mpi-cpp-listing.linenums,cpp]
----
include::KickOff/mpi-pi++.cpp[]
----

.C MPI implementation
[source#mpi-c-listing.linenums,c]
----
include::KickOff/mpi-pi.c[]
----

include::scripts/trailing-scripts.adoc[]